package com.androidcrypt.crypto

import org.junit.Assert.*
import org.junit.Test

/**
 * Test vectors for XTS-AES from IEEE P1619 standard
 * These tests verify bit-exact compatibility with the standard implementation
 */
class VeraCryptTestVectors {

    /**
     * Simple XTS-AES-128 test with 32 bytes
     * Keys: all zeros, Data unit: 0, Plaintext: all zeros
     * This tests basic XTS functionality with minimal data
     */
    @Test
    fun testXTSAESSimple() {
        // 128-bit keys (16 bytes each for encryption and tweak, 32 bytes total)
        val key1 = ByteArray(16) { 0x00 }
        val key2 = ByteArray(16) { 0x00 }
        
        val dataUnitNo = 0L
        val plaintext = ByteArray(32) { 0x00 }

        // Combine keys for XTS mode (32 bytes total for AES-128)
        val fullKey = ByteArray(32)
        System.arraycopy(key1, 0, fullKey, 0, 16)
        System.arraycopy(key2, 0, fullKey, 16, 16)

        val xts = XTSMode(fullKey, EncryptionAlgorithm.AES)
        val ciphertext = xts.encrypt(plaintext, dataUnitNo)

        // Just verify encrypt/decrypt round-trip works
        val decrypted = xts.decrypt(ciphertext, dataUnitNo)
        assertArrayEquals(plaintext, decrypted)
    }
    
    /**
     * VeraCrypt XTS Test Vector (IEEE P1619 Vector 10)
     * This is the first vector in VeraCrypt's Tests.c (XTS_vectors[0])
     * AES-256, 512 bytes, data unit 0xff00000000000000
     */
    @Test
    fun testXTSAESVector10() {
        // 256-bit keys (32 bytes each for encryption and tweak, 64 bytes total)
        val key1 = byteArrayOf(
            0x27, 0x18, 0x28, 0x18, 0x28, 0x45, 0x90.toByte(), 0x45,
            0x23, 0x53, 0x60, 0x28, 0x74, 0x71, 0x35, 0x26,
            0x62, 0x49, 0x77, 0x57, 0x24, 0x70, 0x93.toByte(), 0x69,
            0x99.toByte(), 0x59, 0x57, 0x49, 0x66, 0x96.toByte(), 0x76, 0x27
        )

        val key2 = byteArrayOf(
            0x31, 0x41, 0x59, 0x26, 0x53, 0x58, 0x97.toByte(), 0x93.toByte(),
            0x23, 0x84.toByte(), 0x62, 0x64, 0x33, 0x83.toByte(), 0x27, 0x95.toByte(),
            0x02, 0x88.toByte(), 0x41, 0x97.toByte(), 0x16, 0x93.toByte(), 0x99.toByte(), 0x37,
            0x51, 0x05, 0x82.toByte(), 0x09, 0x74, 0x94.toByte(), 0x45, 0x92.toByte()
        )

        // Data unit from Tests.c: { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff }
        // VeraCrypt uses BE64() to read this, so it's BIG ENDIAN = 0xff (255)
        val dataUnitNo = 0xffL

        val plaintext = ByteArray(512) { it.toByte() }

        // Expected ciphertext from VeraCrypt Tests.c (all 512 bytes)
        val expectedCiphertext = byteArrayOf(
            0x1c, 0x3b, 0x3a, 0x10, 0x2f, 0x77, 0x03, 0x86.toByte(),
            0xe4.toByte(), 0x83.toByte(), 0x6c, 0x99.toByte(), 0xe3.toByte(), 0x70, 0xcf.toByte(), 0x9b.toByte(),
            0xea.toByte(), 0x00, 0x80.toByte(), 0x3f, 0x5e, 0x48, 0x23, 0x57,
            0xa4.toByte(), 0xae.toByte(), 0x12, 0xd4.toByte(), 0x14, 0xa3.toByte(), 0xe6.toByte(), 0x3b,
            0x5d, 0x31, 0xe2.toByte(), 0x76, 0xf8.toByte(), 0xfe.toByte(), 0x4a, 0x8d.toByte(),
            0x66, 0xb3.toByte(), 0x17, 0xf9.toByte(), 0xac.toByte(), 0x68, 0x3f, 0x44,
            0x68, 0x0a, 0x86.toByte(), 0xac.toByte(), 0x35, 0xad.toByte(), 0xfc.toByte(), 0x33,
            0x45, 0xbe.toByte(), 0xfe.toByte(), 0xcb.toByte(), 0x4b, 0xb1.toByte(), 0x88.toByte(), 0xfd.toByte(),
            0x57, 0x76, 0x92.toByte(), 0x6c, 0x49, 0xa3.toByte(), 0x09, 0x5e,
            0xb1.toByte(), 0x08, 0xfd.toByte(), 0x10, 0x98.toByte(), 0xba.toByte(), 0xec.toByte(), 0x70,
            0xaa.toByte(), 0xa6.toByte(), 0x69, 0x99.toByte(), 0xa7.toByte(), 0x2a, 0x82.toByte(), 0xf2.toByte(),
            0x7d, 0x84.toByte(), 0x8b.toByte(), 0x21, 0xd4.toByte(), 0xa7.toByte(), 0x41, 0xb0.toByte(),
            0xc5.toByte(), 0xcd.toByte(), 0x4d, 0x5f, 0xff.toByte(), 0x9d.toByte(), 0xac.toByte(), 0x89.toByte(),
            0xae.toByte(), 0xba.toByte(), 0x12, 0x29, 0x61, 0xd0.toByte(), 0x3a, 0x75,
            0x71, 0x23, 0xe9.toByte(), 0x87.toByte(), 0x0f, 0x8a.toByte(), 0xcf.toByte(), 0x10,
            0x00, 0x02, 0x08, 0x87.toByte(), 0x89.toByte(), 0x14, 0x29, 0xca.toByte(),
            0x2a, 0x3e, 0x7a, 0x7d, 0x7d, 0xf7.toByte(), 0xb1.toByte(), 0x03,
            0x55, 0x16, 0x5c, 0x8b.toByte(), 0x9a.toByte(), 0x6d, 0x0a, 0x7d,
            0xe8.toByte(), 0xb0.toByte(), 0x62, 0xc4.toByte(), 0x50, 0x0d, 0xc4.toByte(), 0xcd.toByte(),
            0x12, 0x0c, 0x0f, 0x74, 0x18, 0xda.toByte(), 0xe3.toByte(), 0xd0.toByte(),
            0xb5.toByte(), 0x78, 0x1c, 0x34, 0x80.toByte(), 0x3f, 0xa7.toByte(), 0x54,
            0x21, 0xc7.toByte(), 0x90.toByte(), 0xdf.toByte(), 0xe1.toByte(), 0xde.toByte(), 0x18, 0x34,
            0xf2.toByte(), 0x80.toByte(), 0xd7.toByte(), 0x66, 0x7b, 0x32, 0x7f, 0x6c,
            0x8c.toByte(), 0xd7.toByte(), 0x55, 0x7e, 0x12, 0xac.toByte(), 0x3a, 0x0f,
            0x93.toByte(), 0xec.toByte(), 0x05, 0xc5.toByte(), 0x2e, 0x04, 0x93.toByte(), 0xef.toByte(),
            0x31, 0xa1.toByte(), 0x2d, 0x3d, 0x92.toByte(), 0x60, 0xf7.toByte(), 0x9a.toByte(),
            0x28, 0x9d.toByte(), 0x6a, 0x37, 0x9b.toByte(), 0xc7.toByte(), 0x0c, 0x50,
            0x84.toByte(), 0x14, 0x73, 0xd1.toByte(), 0xa8.toByte(), 0xcc.toByte(), 0x81.toByte(), 0xec.toByte(),
            0x58, 0x3e, 0x96.toByte(), 0x45, 0xe0.toByte(), 0x7b, 0x8d.toByte(), 0x96.toByte(),
            0x70, 0x65, 0x5b, 0xa5.toByte(), 0xbb.toByte(), 0xcf.toByte(), 0xec.toByte(), 0xc6.toByte(),
            0xdc.toByte(), 0x39, 0x66, 0x38, 0x0a, 0xd8.toByte(), 0xfe.toByte(), 0xcb.toByte(),
            0x17, 0xb6.toByte(), 0xba.toByte(), 0x02, 0x46, 0x9a.toByte(), 0x02, 0x0a,
            0x84.toByte(), 0xe1.toByte(), 0x8e.toByte(), 0x8f.toByte(), 0x84.toByte(), 0x25, 0x20, 0x70,
            0xc1.toByte(), 0x3e, 0x9f.toByte(), 0x1f, 0x28, 0x9b.toByte(), 0xe5.toByte(), 0x4f,
            0xbc.toByte(), 0x48, 0x14, 0x57, 0x77, 0x8f.toByte(), 0x61, 0x60,
            0x15, 0xe1.toByte(), 0x32, 0x7a, 0x02, 0xb1.toByte(), 0x40, 0xf1.toByte(),
            0x50, 0x5e, 0xb3.toByte(), 0x09, 0x32, 0x6d, 0x68, 0x37,
            0x8f.toByte(), 0x83.toByte(), 0x74, 0x59, 0x5c, 0x84.toByte(), 0x9d.toByte(), 0x84.toByte(),
            0xf4.toByte(), 0xc3.toByte(), 0x33, 0xec.toByte(), 0x44, 0x23, 0x88.toByte(), 0x51,
            0x43, 0xcb.toByte(), 0x47, 0xbd.toByte(), 0x71, 0xc5.toByte(), 0xed.toByte(), 0xae.toByte(),
            0x9b.toByte(), 0xe6.toByte(), 0x9a.toByte(), 0x2f, 0xfe.toByte(), 0xce.toByte(), 0xb1.toByte(), 0xbe.toByte(),
            0xc9.toByte(), 0xde.toByte(), 0x24, 0x4f, 0xbe.toByte(), 0x15, 0x99.toByte(), 0x2b,
            0x11, 0xb7.toByte(), 0x7c, 0x04, 0x0f, 0x12, 0xbd.toByte(), 0x8f.toByte(),
            0x6a, 0x97.toByte(), 0x5a, 0x44, 0xa0.toByte(), 0xf9.toByte(), 0x0c, 0x29,
            0xa9.toByte(), 0xab.toByte(), 0xc3.toByte(), 0xd4.toByte(), 0xd8.toByte(), 0x93.toByte(), 0x92.toByte(), 0x72,
            0x84.toByte(), 0xc5.toByte(), 0x87.toByte(), 0x54, 0xcc.toByte(), 0xe2.toByte(), 0x94.toByte(), 0x52,
            0x9f.toByte(), 0x86.toByte(), 0x14, 0xdc.toByte(), 0xd2.toByte(), 0xab.toByte(), 0xa9.toByte(), 0x91.toByte(),
            0x92.toByte(), 0x5f, 0xed.toByte(), 0xc4.toByte(), 0xae.toByte(), 0x74, 0xff.toByte(), 0xac.toByte(),
            0x6e, 0x33, 0x3b, 0x93.toByte(), 0xeb.toByte(), 0x4a, 0xff.toByte(), 0x04,
            0x79, 0xda.toByte(), 0x9a.toByte(), 0x41, 0x0e, 0x44, 0x50, 0xe0.toByte(),
            0xdd.toByte(), 0x7a, 0xe4.toByte(), 0xc6.toByte(), 0xe2.toByte(), 0x91.toByte(), 0x09, 0x00,
            0x57, 0x5d, 0xa4.toByte(), 0x01, 0xfc.toByte(), 0x07, 0x05, 0x9f.toByte(),
            0x64, 0x5e, 0x8b.toByte(), 0x7e, 0x9b.toByte(), 0xfd.toByte(), 0xef.toByte(), 0x33,
            0x94.toByte(), 0x30, 0x54, 0xff.toByte(), 0x84.toByte(), 0x01, 0x14, 0x93.toByte(),
            0xc2.toByte(), 0x7b, 0x34, 0x29, 0xea.toByte(), 0xed.toByte(), 0xb4.toByte(), 0xed.toByte(),
            0x53, 0x76, 0x44, 0x1a, 0x77, 0xed.toByte(), 0x43, 0x85.toByte(),
            0x1a, 0xd7.toByte(), 0x7f, 0x16, 0xf5.toByte(), 0x41, 0xdf.toByte(), 0xd2.toByte(),
            0x69, 0xd5.toByte(), 0x0d, 0x6a, 0x5f, 0x14, 0xfb.toByte(), 0x0a,
            0xab.toByte(), 0x1c, 0xbb.toByte(), 0x4c, 0x15, 0x50, 0xbe.toByte(), 0x97.toByte(),
            0xf7.toByte(), 0xab.toByte(), 0x40, 0x66, 0x19, 0x3c, 0x4c, 0xaa.toByte(),
            0x77, 0x3d, 0xad.toByte(), 0x38, 0x01, 0x4b, 0xd2.toByte(), 0x09,
            0x2f, 0xa7.toByte(), 0x55, 0xc8.toByte(), 0x24, 0xbb.toByte(), 0x5e, 0x54,
            0xc4.toByte(), 0xf3.toByte(), 0x6f, 0xfd.toByte(), 0xa9.toByte(), 0xfc.toByte(), 0xea.toByte(), 0x70,
            0xb9.toByte(), 0xc6.toByte(), 0xe6.toByte(), 0x93.toByte(), 0xe1.toByte(), 0x48, 0xc1.toByte(), 0x51
        )

        // Combine keys for XTS mode
        val fullKey = ByteArray(64)
        System.arraycopy(key1, 0, fullKey, 0, 32)
        System.arraycopy(key2, 0, fullKey, 32, 32)

        val xts = XTSMode(fullKey, EncryptionAlgorithm.AES)
        val ciphertext = xts.encrypt(plaintext, dataUnitNo)

        assertArrayEquals(expectedCiphertext, ciphertext)

        val decrypted = xts.decrypt(ciphertext, dataUnitNo)
        assertArrayEquals(plaintext, decrypted)
    }
}
